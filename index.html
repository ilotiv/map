<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background: white;
        }
    </style>
    <script>
        function login() {
        // Use an AJAX request to call the PHP script
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
            // Check if the login was successful
            if (xhr.responseText === "Login successful!") {
                // Redirect the user to the external website
                window.location.href = "https://moodle.caseine.org/";
            } else {
                alert("Login failed!");
            }
            }
        };
        xhr.send("action=login");
        }
    </script>
</head>
<body>
    <button onclick="login()">Login</button>

    <?php
        if ($_SERVER['REQUEST_METHOD'] === 'POST' && $_POST['action'] === 'login') {
            // Define the login page URL
            $login_page_url = 'https://moodle.caseine.org/login/index.php';

            // Use cURL to retrieve the HTML of the login page
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, $login_page_url);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            $html = curl_exec($ch);
            curl_close($ch);

            // Use regular expressions to extract the logintoken value from the HTML
            preg_match('/<input type="hidden" name="logintoken" value="([^"]+)">/', $html, $matches);
            $logintoken = $matches[1];
                    // Define the login URL and the data to be sent with the request
        $login_url = 'https://moodle.caseine.org/login/index.php';
        $username = 'testcna';
        $password = '*TestCNA38+';
        $anchor = '';
        $data = array(
            'username' => $username,
            'password' => $password,
            'logintoken' => $logintoken,
            'anchor' => $anchor
        );

        // Use cURL to make the POST request to the login URL with the data
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $login_url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $response = curl_exec($ch);

        // Check if the login was successful
        if (curl_getinfo($ch, CURLINFO_HTTP_CODE) == 200) {
            echo 'Login successful!';
        } else {
            echo 'Login failed!';
        }

        curl_close($ch);
        }
    ?>
</body>
</html>